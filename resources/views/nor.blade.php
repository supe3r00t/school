

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <link rel="stylesheet"
          href="/auth/resources/530r8/login/unified/branding/css/fancy_fileupload.css"
          type="text/css" media="all">
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-W3NRXB6');</script>
    <!-- End Google Tag Manager -->

    <base href="/" >
    <link async rel="manifest" href="/auth/resources/530r8/login/unified/branding/manifest.json">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#ffffff">
    <meta name="author" content="Ministry of Commerce">
    <meta name="description" content="mci">
    <link async rel="apple-touch-icon" sizes="180x180" href="/auth/resources/530r8/login/unified/branding/icons/apple-touch-icon.png">
    <link async rel="icon" type="image/png" sizes="32x32" href="/auth/resources/530r8/login/unified/branding/icons/favicon-32x32.png">
    <link async rel="icon" type="image/png" sizes="16x16" href="/auth/resources/530r8/login/unified/branding/icons/favicon-16x16.png">
    <link async rel="mask-icon" href="/auth/resources/530r8/login/unified/branding/icons/safari-pinned-tab.svg" color="#5bbad5">


    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>النفاذ التجاري الموحد</title>
    <link async rel="icon" href="/auth/resources/530r8/login/unified/branding/icons/favicon.ico" onload="this.media='all'"/>
    <link async href="/auth/resources/530r8/login/unified/branding/css/rtl/style.css" rel="stylesheet" onload="this.media='all'"/>



    <link async href="/auth/resources/530r8/login/unified/branding/css/select2.min.css" rel="stylesheet" />
    <link async href="/auth/resources/530r8/login/unified/branding/css/rtl/intlTelInput.min.css" rel="stylesheet" />
    <link href="/auth/resources/530r8/login/unified/branding/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
</head>

<body class="">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3NRXB6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


<div class="login-pf-page">
    <div id="kc-header" class="login-pf-page-header d-none">
        <div id="kc-header-wrapper" class="">Ministry Of Commerce</div>
    </div>
    <main class="mainContent">
        <section class="login">
            <div class="login-background"> </div>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 col-sm-10 col-md-8 col-lg-6 login-pf-accounts">


                        <!--  =============== Login Wrapper  ## START ## ===============  -->
                        <div class="login-wrapper">




                            <!--
                            <div class="wrapper-title">
-->
                            <!--  =============== Login Header  ## START ## ===============  -->
                            <div class="login-header">
                                <div class="login-currentAccount">
                                    <img class="login--accountLogo" src="/auth/resources/530r8/login/unified/branding/images/logo-mci-green.svg" alt="">
                                    <p class="login--accountName"> تسجيل دخول بحساب <span class="brandName">النفاذ التجاري الموحد</span> </p>
                                </div>
                            </div>






                            <!--  =============== Login Header  ## END ## ===============  -->
                            <!--  =============== Login Body  ## START ## ===============  -->

                            <div class="login-body no-round-bottom">

                                <!-- <div class="login-logoWrapper">
                                    <img src="/auth/resources/530r8/login/unified/branding/images/logo-brand.svg" class="login-logo" alt="" srcset="">
                                </div>
                                <p class="login-brand">
                                    <strong> تسجيل دخول بحساب </strong>
                                    النفاذ التجاري الموحد
                                </p> -->
                                <!-- From ## START ## -->






                                <div id="kc-form">
                                    <div id="kc-form-wrapper">

                                        <div class="login-logo">
                                            <img src="/auth/resources/530r8/login/unified/branding/images/efile-web-prod-logo.jpg" class="login-logo" alt="" srcset="" onerror="this.remove();">
                                            <h4 class="login-title mb-0">أهلا بك عميل وزارة التجارة</h4>
                                            <h4 class="login-logo-register">تسجيل الدخول </h4>

                                        </div>
                                        <form id="kc-form-login" onsubmit="login.disabled = true; return true;" action="https://sso.mc.gov.sa/auth/realms/mci/login-actions/authenticate?session_code=TXJG6pRP1tRzaztfBojTX-3WrBrZrPOCwEQjc50-oLE&amp;execution=d0c586b2-8b78-4255-9372-cb7c7a797812&amp;client_id=efile-web-prod&amp;tab_id=EzgfjXozia0" method="post" >
                                            <div class="form-group">
                                                <label for="LoginUsername" class="control-label">
                                                    رقم الهوية أو الإقامة / اسم المستخدم
                                                </label>

                                                <div class="input-group is-havingInside">
                                                    <div class="input-group-inside">
                                                        <svg class="icon">
                                                            <use xlink:href="/auth/resources/530r8/login/unified/branding/images/icons/svg-all.svg#icon-user">
                                                            </use>
                                                        </svg>
                                                    </div>
                                                    <input maxlength="50" tabindex="1" id="LoginUsername"
                                                           placeholder="مثلا: 123456789 او Abdullahali "
                                                           class="form-control" name="username" value=""
                                                           type="text" autofocus autocomplete="off"
                                                           required  title="مثلا: 123456789 او Abdullahali "
                                                           oninvalid="this.setCustomValidity('الرجاء إدخال رقم الهوية/ اسم المستخدم');"
                                                           oninput="setCustomValidity('');"
                                                           onKeyPress="if(!/^[A-Za-z0-9]*$/.test(event.key) || this.value.length == 50) return false;"/>
                                                </div>
                                            </div>


                                            <div id="kc-form-buttons" class="form-group">
                                                <input tabindex="5" class="btn btn-primary w-100" name="login" id="kc-login" type="submit"
                                                       value='التالي'/>
                                            </div>

                                        </form>

                                    </div>

                                </div>

                                <div id="kc-info" class="login-pf-signup">
                                    <div id="kc-info-wrapper" class="">


                                    </div>
                                </div>
                                <!-- From ## END ## -->

                            </div>
                            <!--  =============== Login Body  ## END ## ===============  -->

                            <!--  =============== Login Footer   ## START ## ===============  -->
                            <div class="login-footer">
                                <div class="float-left w-50 text-left">
                                    <a class="text-returnPassword"  aria-label="login" href="/auth/realms/mci/login-actions/reset-credentials?client_id=efile-web-prod&amp;tab_id=EzgfjXozia0">نسيت كلمة المرور؟</a>
                                </div>

                                <div class="float-left w-50  text-right">
                                    <a class="text-createNew" aria-label="register" href="/auth/realms/mci/login-actions/registration?client_id=efile-web-prod&amp;tab_id=EzgfjXozia0">إنشاء حساب</a>

                                </div>
                            </div>
                            <!--  =============== Login Footer   ## END ## ===============  -->
                        </div>
                        <!--  =============== Login Wrapper  ## START ## ===============  -->
                        <!--  =============== Login Another way to login  ## END ## ===============  -->
                        <!--  =============== Login Another way to login  ## START ## ===============  -->
                        <div class="login-differentAccounts">
                            <h5 class="login-label">
                                الدخول بإستخدام حسابك لدى:
                            </h5>
                            <a href="/auth/realms/mci/broker/iamsa/login?client_id=efile-web-prod&amp;tab_id=EzgfjXozia0&amp;session_code=TXJG6pRP1tRzaztfBojTX-3WrBrZrPOCwEQjc50-oLE" class="differentAccount"  aria-label="provider">
                                <div class="differentAccount-header">
                                    <img src="/auth/resources/530r8/login/unified/branding/images/logo-iamsa.png" onerror='this.onerror = null; this.src="/auth/resources/530r8/login/unified/branding/images/logo-iamsa.svg"' alt="">
                                </div>
                                <div class="differentAccount-body">
                                    <h3 class="differentAccount-title">
                                        دخول بحساب النفاذ الوطني الموحد
                                    </h3>
                                    <p class="differentAccount-desc">
                                        يمكنك الدخول بحسابك في منصة النفاذ الوطني الموحد

                                    </p>

                                    <span class="differentAccount-enter">
                                            <svg class="icon">
                                                <use xlink:href="/auth/resources/530r8/login/unified/branding/images/icons/svg-all.svg#icon-arrow-left">
                                                </use>
                                            </svg>
                                        </span>

                                </div>
                            </a>
                        </div>



                        <!--  =============== Login Another way to login  ## END ## ===============  -->
                        <div class="login-setting">
                            <a class="float-left"  aria-label="login" href="https://efile.mc.gov.sa/ssoredirect">العودة للنظام </a>

                            <a href="javascript:currentUrl('en')"  aria-label="lang" class="float-right">English</a>

                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>

</div>

<script>
    //     // Check that service workers are supported
    //   console.log("Hamad", "3333333333333333333")

    //    const urlParams = new URLSearchParams(window.location.search);
    //    const myParam = urlParams.get('ui_locales');
    //        console.log("Hamad myParam")
    //        console.log("Hamad",myParam)


    //
    //   if ('serviceWorker' in navigator) {
    //       window.addEventListener('load', () => {
    //           navigator.serviceWorker.register('/sw.js')
    //           .then(function (reg) { console.log("Service Worker Registered", reg); })
    //           .catch(function (err) { console.log("Service Worker Registered", err); });
    //       });
    //   }
    window.onload = function()
    {
        var kcsession = getCookie('KEYCLOAK_SESSION');
        if(kcsession)
            document.getElementsByClassName('login-footer')[0].style.display='none';
    }

    function currentUrl(lang) {
        var currentURI= window.location.href;
        if(currentURI.includes('ui_locales'))
        {
            console.log("Hamad if")
            if(lang == 'ar')
                window.location.href=currentURI.replace('ui_locales=en', 'ui_locales=ar');
            else if(lang == 'en')
                window.location.href=currentURI.replace('ui_locales=ar', 'ui_locales=en');
        }
        else if(currentURI.includes('kc_locale') && currentURI.includes('execution'))
        {
            console.log("Hamad if")
            if(lang == 'ar')
                window.location.href=currentURI.replace('kc_locale=en', 'kc_locale=ar');
            else if(lang == 'en')
                window.location.href=currentURI.replace('kc_locale=ar', 'kc_locale=en');
        }
        else
        {
            if(currentURI.includes('execution')){
                if(currentURI.includes("?"))
                    window.location.href=currentURI + '&kc_locale=' + lang
                else
                    window.location.href=currentURI + '?kc_locale=' + lang
            }
            else{
                if(currentURI.includes("?"))
                    window.location.href=currentURI + '&ui_locales=' + lang
                else
                    window.location.href=currentURI + '?ui_locales=' + lang
            }

        }
    }


    //            let defaultLanguage = 'العربية' === 'العربية' ? 'ar' : 'en'
    //            var currentURI= window.location.href;
    //                console.log(currentURI.includes('ui_locales'))
    //                if(currentURI.includes('ui_locales') === false && currentURI.includes('kc_locale') === false && currentURI.includes('execution') === false ){
    //                    console.log("Hamad inside the function")
    //                    if(currentURI.includes("?")){
    //                        window.location.href=currentURI + '&ui_locales=' + defaultLanguage
    //                    }
    //                    else{
    //                        window.location.href=currentURI + '?ui_locales=' + defaultLanguage
    //                    }
    //                }
    //                else if(currentURI.includes('kc_locale') && currentURI.includes('execution') === false ){
    //                        window.location.href=currentURI.replace('kc_locale','ui_locales')
    //                }


</script>

<script src="https://code.jquery.com/jquery-3.6.3.min.js" type="text/javascript"></script>
<script src="/auth/resources/530r8/login/unified/js/rollups/aes.js"></script>
<script src="/auth/resources/530r8/login/unified/js/components/enc-base64-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="/auth/resources/530r8/login/unified/branding/js/bootstrap-hijri-datetimepicker.js"></script>

<script type="text/javascript"
        src="/auth/resources/530r8/login/unified/branding/js/fancyupload/jquery.ui.widget.js"></script>
<script type="text/javascript"
        src="/auth/resources/530r8/login/unified/branding/js/fancyupload/jquery.fileupload.js"></script>

<script type="text/javascript"
        src="/auth/resources/530r8/login/unified/branding/js/fancyupload/jquery.fancy-fileupload.js"></script>
<script async>

    window.onload = function()
    {
        //PreventPastOnId('LoginUsername');


        try{
            reloadCaptcha();
            checkCountry();
            PreventPastOnId('user.attributes.city');
            PreventPastOnId('user.attributes.cityEn');
            PreventPastOnId('user.attributes.cityId');
        }catch{}
    }

    function reloadCaptcha()
    {
        if(document.getElementById("CaptchaCodeRequestId") && document.getElementById("CaptchaCodeImage"))
        {
            setTimeout(function(){
                var chRequest = guid();
                setCookie("chRequest",chRequest,5);

                document.getElementById("CaptchaCodeRequestId").value = chRequest;
                getCaptcha(chRequest,"CaptchaCodeImage");
            },1);
        }
    }

    function getCaptcha(cname, element)
    {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState === this.DONE) {
                var res = xhr.responseText;
                document.getElementById(element).src= 'data:image/jpg;base64,' + res;
            }
        }
        //xhr.open("GET", "https://eai-dev202.thiqah.sa/CaptchaApi/api/Images?requestId="+cname+"&width=150");
        xhr.open("GET", "/api/Images?requestId="+cname+"&width=150");
        xhr.send();
    }

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }

    function setCookie(name,value,seconds) {
        var expires = "";
        if (seconds) {
            var date = new Date();
            date.setTime(date.getTime()+(seconds*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "")  + expires + "; path=/auth/realms/mci/; secure";
    }

    function deleteCookie(name) {
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/auth/realms/mci/';
        var otpTextBox = document.getElementById('totp');
        otpTextBox.value = '_ _ _ _';
        otpTextBox.disabled = true;
        var otpButton = document.getElementById('kc-login-otp');
        if(!otpButton)
            otpButton = document.getElementById('th-registration-otp-verify');
        otpButton.disabled = true;

    }

    function guid() {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
    }


    function TogglePassword(elementId) {
        var x = document.getElementById(elementId);
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }
    }
    function unLockPassword(e,elementId)  {
        e.target.classList.add('fa-eye')
        e.target.classList.remove('fa-eye-slash')
        var x = document.getElementById(elementId);
        x.type = "text";

    }
    function lockPassword(e,elementId) {
        e.target.classList.add('fa-eye-slash')
        e.target.classList.remove('fa-eye')
        var x = document.getElementById(elementId);
        x.type = "password";

    }
    function PreventPastOnId(id) {
        const LoginUsernameInput = document.getElementById(id);
        LoginUsernameInput.onpaste = e => e.preventDefault();
    }

</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

<script   src="/auth/resources/530r8/login/unified/branding/js/svgxuse.js" type="text/javascript"></script>


<script>
    function setValueBasedOn(valueSelect,valueArID,valueEnID,valueID) {
        var text = document.getElementById(valueSelect).value;
        const firstValueAr = text.split("|")[0];
        const secondValueEn = text.split("|")[1];
        const thirdValueID_ = text.split("|")[2];
        document.getElementById(valueArID).value = firstValueAr;
        document.getElementById(valueEnID).value = secondValueEn;
        document.getElementById(valueID).value = thirdValueID_;
    }

    function checkCountry() {
        if(document.getElementById("user.attributes.country").value != "SA"){
            $('#city_e').attr("disabled", true);
            $("#city_e").val(null).change();
            document.getElementById("user.attributes.city").value = "";
            document.getElementById("user.attributes.cityEn").value = "";
            document.getElementById("user.attributes.cityId").value = "";
        }else{
            $('#city_e').prop('selectedIndex', 0);
            $('#city_e').attr("disabled", false);
        }
    }
</script>



<script>
    $(document).ready(function () {
        timer = setTimeout(function () {
            $('#dvError').hide();
        }, 5000);
    });


</script>

</body>
</html>
